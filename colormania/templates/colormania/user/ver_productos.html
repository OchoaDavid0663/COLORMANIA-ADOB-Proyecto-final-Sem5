{% extends "colormania/base.html" %}
{% load static %}
{% block title %}Productos y Accesorios - COLORMANIA{% endblock %}
{% block content %}
<div class="container mt-0 pt-0">
    <div class="text-center mb-4">
        <h1 class="bobby display-4" style="color: #ff0088;">
            <i class="fas fa-paint-brush me-2"></i> PRODUCTOS Y ACCESORIOS
        </h1>
        <p class="lead bobby fs-3" style="color: #131128;">
            Los productos perfectos para crear tus proximas obras
        </p>
    </div>
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
    {% for producto in productos %}
    <div class="col">
        <div class="card h-100 shadow-lg border-0 overflow-hidden transform-hover" style="border-radius: 25px;">
            
            <!-- Imagen y Datos (Igual que antes) -->
            <img src="{{ producto.foto_producto.url }}" class="card-img-top" style="height: 280px; object-fit: cover;">
            
            <div class="card-body text-center p-4">
                <h5 class="bobby mb-2">{{ producto.nombre }}</h5>
                <p class="fw-bold fs-3" style="color: #64c1ff;">${{ producto.precio }}</p>

                {% if producto.stock > 0 %}
                    <div class="d-flex justify-content-center align-items-center mt-3">
                        <!-- 2. BOTÓN: Llama a la función JS pasando la URL y el ID del producto -->
                        <button 
                            type="button"
                            data-url="{% url 'agregar_producto' producto.id %}"
                            data-id="{{ producto.id }}"
                            onclick="agregarAlCarrito(this)"
                            class="btn btn-success rounded-pill px-3 shadow-lg bobby">
                            <i class="fas fa-cart-plus"></i>
                        </button>

                    </div>
                    <small class="text-muted mt-2 d-block">Stock: {{ producto.stock }}</small>
                {% else %}
                    <p class="text-danger mt-3 mb-0 bobby">Agotado</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
    <div style="display:none;">
        {% csrf_token %}
    </div>
    <script>
        function agregarAlCarrito(boton) {
            // 1. Leer los datos guardados en el botón
            var url = boton.getAttribute('data-url');
            var productoId = boton.getAttribute('data-id');

            // 2. Obtener la cantidad del input correspondiente
            var inputCantidad = document.getElementById('cantidad-' + productoId);
            var cantidad = inputCantidad ? inputCantidad.value : 1;

            // 3. Obtener el token CSRF
            var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            // 4. Crear el formulario invisible y enviarlo
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = url;

            var inputCsrf = document.createElement('input');
            inputCsrf.type = 'hidden';
            inputCsrf.name = 'csrfmiddlewaretoken';
            inputCsrf.value = csrfToken;
            form.appendChild(inputCsrf);

            var inputCant = document.createElement('input');
            inputCant.type = 'hidden';
            inputCant.name = 'cantidad';
            inputCant.value = cantidad;
            form.appendChild(inputCant);

            document.body.appendChild(form);
            form.submit();
        }
    </script>
    <style>
        .transform-hover:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 25px 50px rgba(100, 193, 255, 0.5) !important;
        }
    </style>
</div>

{% endblock %}