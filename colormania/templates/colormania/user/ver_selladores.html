{% extends "colormania/base.html" %}
{% load static %}

{% block title %}Selladores - COLORMANIA{% endblock %}

{% block content %}
<div class="container mt-0 pt-0">
    <!-- CSRF TOKEN OCULTO (Necesario para el JavaScript) -->
    <div style="display:none;">
        {% csrf_token %}
    </div>

    <div class="text-center mb-4">
        <h1 class="bobby display-4" style="color: #ff0088;">
            <i class="fas fa-spray-can me-2"></i> SELLADORES Y BARNICES
        </h1>
        <p class="lead bobby fs-3" style="color: #131128;">
            Protege tu obra maestra con el acabado perfecto
        </p>
    </div>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
        {% for sellador in selladores %}
        <div class="col">
            <div class="card h-100 shadow-lg border-0 overflow-hidden transform-hover"
                 style="border-radius: 25px; transition: all 0.4s;">
                
                <!-- Imagen -->
                {% if sellador.foto_sellador %}
                    <img src="{{ sellador.foto_sellador.url }}" 
                         class="card-img-top" 
                         alt="{{ sellador.nombre }}"
                         style="height: 280px; object-fit: cover;">
                {% else %}
                    <div class="bg-light d-flex align-items-center justify-content-center" 
                         style="height: 280px;">
                        <h1 class="display-1 text-muted">Shield</h1>
                    </div>
                {% endif %}

                <div class="card-body text-center p-4">
                    <h5 class="bobby mb-2" style="color: #131128; font-size: 1.3rem;">
                        {{ sellador.nombre }}
                    </h5>
                    <p class="text-muted small mb-3">
                        {{ sellador.descripcion|truncatewords:12 }}
                    </p>
                    <p class="fw-bold fs-3" style="color: #ffae00;">
                        ${{ sellador.precio }}
                    </p>

                
                    {% if sellador.stock > 0 %}
                        <div class="d-flex justify-content-center align-items-center mt-3 gap-2">
                            
                        
                            <button 
                                type="button"
                                data-url="{% url 'agregar_sellador' sellador.id %}"
                                data-id="{{ sellador.id }}"
                                onclick="agregarAlCarrito(this)"
                                class="btn btn-success rounded-pill px-3 shadow-lg bobby">
                                <i class="fas fa-cart-plus"></i>
                            </button>

                        </div>
                        <small class="text-muted mt-2 d-block">Stock: {{ sellador.stock }}</small>
                    {% else %}
                        <p class="text-danger mt-3 mb-0 bobby">
                            <i class="fas fa-times-circle"></i> Agotado
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <i class="fas fa-shield-alt fa-5x text-muted mb-4"></i>
            <h3 class="text-muted bobby">Pronto tendremos selladores increíbles...</h3>
            <p class="text-muted">¡La protección perfecta para tu arte está en camino!</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.transform-hover:hover {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 25px 50px rgba(255, 174, 0, 0.4) !important;
}
</style>

<!-- SCRIPT REUTILIZABLE -->
<script>
    function agregarAlCarrito(boton) {
        // 1. Leer los datos del botón
        var url = boton.getAttribute('data-url');
        var itemId = boton.getAttribute('data-id');

        // 2. Obtener cantidad
        var input = document.getElementById('cantidad-' + itemId);
        var cantidad = input ? input.value : 1;

        // 3. Obtener Token CSRF
        var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // 4. Crear formulario invisible
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = url;

        // Agregar Token
        var inputCsrf = document.createElement('input');
        inputCsrf.type = 'hidden';
        inputCsrf.name = 'csrfmiddlewaretoken';
        inputCsrf.value = csrfToken;
        form.appendChild(inputCsrf);

        // Agregar Cantidad
        var inputCant = document.createElement('input');
        inputCant.type = 'hidden';
        inputCant.name = 'cantidad';
        inputCant.value = cantidad;
        form.appendChild(inputCant);

        // Enviar
        document.body.appendChild(form);
        form.submit();
    }
</script>

{% endblock %}